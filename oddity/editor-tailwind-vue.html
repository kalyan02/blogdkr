<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oddity Editor - TailwindCSS + Vue</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'mono': ['JetBrains Mono', 'monospace'],
                    },
                    maxWidth: {
                        'editor': '800px',
                    },
                    spacing: {
                        'sidebar': '260px',
                    }
                }
            }
        }
    </script>
</head>
<body class="font-mono bg-white min-h-screen">
    <div id="app">
        <div 
            class="min-h-screen flex flex-col transition-all duration-200">
            
            <!-- Combined navigation and controls bar -->
            <div 
                v-show="!distractionFree"
                class="py-1 relative">
                <div 
                    class="max-w-editor mx-auto px-8 pt-4 flex items-center justify-between"
                    :class="{ 'xl:ml-[calc(50vw-400px)] xl:px-8 xl:max-w-none': wideScreen }">
                    <!-- Navigation links -->
                    <div class="flex gap-1">
                        <a 
                            v-for="link in navLinks" 
                            :key="link.name"
                            :href="link.href"
                            :target="link.target"
                            class="text-gray-600 text-xs px-2 py-1 rounded hover:bg-gray-100 hover:text-gray-900 transition-colors"
                            :class="{ 'bg-blue-600 text-white hover:bg-blue-700 hover:text-white': link.primary }">
                            {{ link.name }}
                        </a>

                        <button 
                            @click="toggleSidebar" 
                            class="bg-white/90 border border-gray-300 rounded px-2 py-1 text-xs text-gray-600 hover:text-gray-900 hover:bg-white hover:border-gray-400 backdrop-blur-sm transition-all"
                            :title="sidebarVisible ? 'Hide sidebar' : 'Show sidebar'">
                            {{ sidebarVisible ? '‚úï' : '‚â°' }}
                        </button>
                        <button 
                            @click="toggleDistractionFree" 
                            class="bg-white/90 border border-gray-300 rounded px-2 py-1 text-xs text-gray-600 hover:text-gray-900 hover:bg-white hover:border-gray-400 backdrop-blur-sm transition-all"
                            title="Distraction-free mode">
                            {{ distractionFree ? '‚óë' : '‚óê' }}
                        </button>
                        <button
                            @click="saveContent" 
                            class="bg-white/90 border border-gray-300 rounded px-2 py-1 text-xs text-green-600 hover:text-white hover:bg-green-600 hover:border-green-600 backdrop-blur-sm transition-all"
                            title="Save">
                            üíæ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main title bar -->
            <div class="py-3 pt-4 flex-shrink-0">
                <div 
                    class="max-w-editor mx-auto px-8 flex items-center justify-between"
                    :class="{ 'xl:ml-[calc(50vw-400px)] xl:px-8 xl:max-w-none': wideScreen }">
                    <div class="text-left">
                        <span class="text-l">Editing: {{ currentFile }}</span>
                    </div>
                </div>
            </div>

            <!-- Main content area -->
            <div
                class="flex-1 flex justify-center relative"
                :class="{
                    'flex-col lg:flex-row': !distractionFree,
                    'justify-center': distractionFree,
                    'lg:justify-start lg:pl-[calc(50vw-400px)]': !distractionFree && wideScreen
                }">

                <!-- Editor area -->
                <div
                    class="w-full max-w-editor px-6 py-2 flex flex-col"
                    :class="{ 'lg:px-8': true }">
                    <textarea
                        v-model="content"
                        @input="autoResize"
                        ref="editor"
                        class="w-full min-h-[500px] border-none p-0 text-sm leading-relaxed resize-none outline-none bg-transparent font-mono"
                        :placeholder="editorPlaceholder">
                    </textarea>
                </div>

                <!-- Sidebar -->
                <div
                    v-show="!distractionFree && sidebarVisible"
                    class="w-full lg:w-sidebar bg-transparent p-3 pl-5 flex-shrink-0 overflow-y-auto sticky top-0 max-h-screen border-t lg:border-t-0 lg:border-l-0 border-gray-200"
                    :class="{ 'lg:static lg:max-h-[calc(100vh-60px)]': true }">
                    
                    <!-- Navigation Section -->
                    <div class="mb-4">
                        <h3 
                            @click="toggleSection('navigation')"
                            class="text-xs uppercase text-gray-600 font-semibold mb-2 cursor-pointer flex items-center justify-between hover:text-gray-900 transition-colors">
                            Navigation
                            <span 
                                class="text-xs transition-transform duration-200"
                                :class="{ 'rotate-180': !sections.navigation }">
                                ‚ñº
                            </span>
                        </h3>
                        <div 
                            v-show="sections.navigation"
                            class="flex flex-col gap-1">
                            <a 
                                v-for="navItem in navigationItems" 
                                :key="navItem.name"
                                :href="navItem.href"
                                :target="navItem.target"
                                class="text-gray-600 text-xs px-2 py-1 rounded hover:bg-gray-100 hover:text-gray-900 transition-colors no-underline"
                                :class="{ 'bg-blue-600 text-white hover:bg-blue-700 hover:text-white': navItem.primary }">
                                {{ navItem.emoji }} {{ navItem.name }}
                            </a>
                        </div>
                    </div>

                    <!-- Front Matter Section -->
                    <div class="mb-4">
                        <h3 
                            @click="toggleSection('frontmatter')"
                            class="text-xs uppercase text-gray-600 font-semibold mb-2 cursor-pointer flex items-center justify-between hover:text-gray-900 transition-colors">
                            Front Matter
                            <span 
                                class="text-xs transition-transform duration-200"
                                :class="{ 'rotate-180': !sections.frontmatter }">
                                ‚ñº
                            </span>
                        </h3>
                        <div v-show="sections.frontmatter">
                            <textarea 
                                v-model="frontmatter"
                                class="w-full h-24 text-xs border border-gray-200 p-2 font-mono resize-y outline-none bg-gray-50 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 rounded"
                                placeholder="title: My Post&#10;tags: [blog, markdown]&#10;date: 2024-01-01&#10;public: true">
                            </textarea>
                        </div>
                    </div>

                    <!-- File Upload Section -->
                    <div class="mb-4">
                        <h3 
                            @click="toggleSection('fileupload')"
                            class="text-xs uppercase text-gray-600 font-semibold mb-2 cursor-pointer flex items-center justify-between hover:text-gray-900 transition-colors">
                            File Upload
                            <span 
                                class="text-xs transition-transform duration-200"
                                :class="{ 'rotate-180': !sections.fileupload }">
                                ‚ñº
                            </span>
                        </h3>
                        <div v-show="sections.fileupload">
                            <!-- Upload Area -->
                            <div 
                                @click="triggerFileInput"
                                @drop="handleDrop"
                                @dragover.prevent="isDragOver = true"
                                @dragenter.prevent="isDragOver = true"
                                @dragleave.prevent="isDragOver = false"
                                class="border-2 border-dashed border-gray-300 p-3 text-center text-gray-600 mb-2 cursor-pointer bg-gray-50 text-xs hover:border-blue-500 hover:bg-blue-50 transition-colors rounded"
                                :class="{ 'border-blue-500 bg-blue-50 text-blue-600': isDragOver }">
                                Drop files here or click to upload
                            </div>
                            <input 
                                ref="fileInput" 
                                type="file" 
                                multiple 
                                class="hidden" 
                                @change="handleFileSelect">
                            
                            <!-- File List -->
                            <div class="max-h-48 overflow-y-auto">
                                <div 
                                    v-for="file in files" 
                                    :key="file.id" 
                                    class="mb-1 relative">
                                    <div class="flex items-center justify-between p-1 hover:bg-gray-50 rounded">
                                        <span 
                                            @click="insertFileLink(file)"
                                            class="text-xs cursor-pointer flex-1 text-gray-700 hover:text-gray-900">
                                            <span 
                                                class="font-semibold"
                                                :class="{
                                                    'text-blue-600': file.type === 'image',
                                                    'text-gray-600': file.type === 'file'
                                                }">
                                                {{ file.type === 'image' ? '[IMG]' : '[FILE]' }}
                                            </span>
                                            {{ file.name }}
                                        </span>
                                        <button 
                                            @click="toggleFileMenu(file.id)"
                                            class="text-xs text-gray-400 hover:text-gray-600 px-1 py-0 bg-transparent border-none cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity">
                                            ‚ãØ
                                        </button>
                                    </div>
                                    
                                    <!-- File Menu -->
                                    <div 
                                        v-show="file.menuOpen"
                                        class="mt-1 bg-gray-50 border border-gray-200 rounded p-1 w-full">
                                        <div 
                                            @click="renameFile(file)"
                                            class="text-xs p-2 cursor-pointer hover:bg-gray-100 border-b border-gray-100">
                                            Rename
                                        </div>
                                        <div 
                                            @click="deleteFile(file.id)"
                                            class="text-xs p-2 cursor-pointer hover:bg-gray-100 text-red-600"
                                            :class="{ 'border-b border-gray-100': file.type === 'image' }">
                                            Delete
                                        </div>
                                        <div 
                                            v-if="file.type === 'image'"
                                            @click="toggleImageResize(file.id)"
                                            class="text-xs p-2 cursor-pointer hover:bg-gray-100">
                                            {{ file.resizeOpen ? 'Hide Resize' : 'Resize' }}
                                        </div>
                                    </div>

                                    <!-- Image Resize Controls -->
                                    <div 
                                        v-if="file.type === 'image' && file.resizeOpen"
                                        class="mt-1 p-2 bg-gray-50 rounded border border-gray-200">
                                        <div class="flex gap-1 items-center">
                                            <input 
                                                v-model="file.resizeWidth" 
                                                type="number" 
                                                placeholder="Width" 
                                                class="w-16 p-1 border border-gray-300 rounded text-xs">
                                            <input 
                                                v-model="file.resizeHeight" 
                                                type="number" 
                                                placeholder="Height" 
                                                class="w-16 p-1 border border-gray-300 rounded text-xs">
                                            <button 
                                                @click="applyImageResize(file)"
                                                class="px-2 py-1 bg-blue-600 text-white border-none rounded text-xs cursor-pointer hover:bg-blue-700">
                                                Apply
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page Search Section -->
                    <div class="mb-4">
                        <h3 
                            @click="toggleSection('search')"
                            class="text-xs uppercase text-gray-600 font-semibold mb-2 cursor-pointer flex items-center justify-between hover:text-gray-900 transition-colors">
                            Page Search
                            <span 
                                class="text-xs transition-transform duration-200"
                                :class="{ 'rotate-180': !sections.search }">
                                ‚ñº
                            </span>
                        </h3>
                        <div v-show="sections.search">
                            <input 
                                v-model="searchQuery"
                                @input="performSearch"
                                type="text" 
                                placeholder="Search pages..." 
                                class="w-full p-2 border border-gray-200 text-xs font-mono outline-none bg-gray-50 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 rounded mb-3">
                            
                            <div class="max-h-48 overflow-y-auto">
                                <div 
                                    v-for="result in filteredSearchResults" 
                                    :key="result.id"
                                    @click="insertPageLink(result)"
                                    class="text-xs p-1 cursor-pointer hover:bg-gray-50 rounded mb-1 text-gray-700 hover:text-gray-900">
                                    <span class="font-semibold text-green-600">[PAGE]</span>
                                    {{ result.title }}
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        
        createApp({
            data() {
                return {
                    content: '',
                    frontmatter: 'title: My Post\ntags: [blog, markdown]\ndate: 2024-01-01\npublic: true',
                    currentFile: 'untitled.md',
                    distractionFree: false,
                    sidebarVisible: true,
                    isDragOver: false,
                    searchQuery: '',
                    wideScreen: false,
                    sections: {
                        navigation: true,
                        frontmatter: true,
                        fileupload: true,
                        search: true
                    },
                    navLinks: [
                        // { name: 'Dashboard', href: '/admin' },
                        // { name: 'Posts', href: '/admin/posts' },
                        // { name: 'Pages', href: '/admin/pages' },
                        // { name: 'Files', href: '/admin/files' },
                        // { name: 'Preview', href: '/preview/untitled', target: '_blank', primary: true }
                    ],
                    navigationItems: [
                        { name: 'Dashboard', href: '/admin', emoji: 'üìä' },
                        { name: 'All Posts', href: '/admin/posts', emoji: 'üìù' },
                        { name: 'Pages', href: '/admin/pages', emoji: 'üìÑ' },
                        { name: 'Files', href: '/admin/files', emoji: 'üóÇÔ∏è' },
                        { name: 'Preview', href: '/preview/untitled', target: '_blank', emoji: 'üëÅÔ∏è', primary: true }
                    ],
                    files: [
                        { 
                            id: 1, 
                            name: 'image1.jpg', 
                            type: 'image', 
                            menuOpen: false, 
                            resizeOpen: false, 
                            resizeWidth: '', 
                            resizeHeight: '' 
                        },
                        { 
                            id: 2, 
                            name: 'document.pdf', 
                            type: 'file', 
                            menuOpen: false 
                        },
                        { 
                            id: 3, 
                            name: 'screenshot.png', 
                            type: 'image', 
                            menuOpen: false, 
                            resizeOpen: false, 
                            resizeWidth: '', 
                            resizeHeight: '' 
                        }
                    ],
                    searchResults: [
                        { id: 1, title: 'Getting Started' },
                        { id: 2, title: 'Features Overview' },
                        { id: 3, title: 'Configuration' },
                        { id: 4, title: 'API Documentation' },
                        { id: 5, title: 'Deployment Guide' },
                        { id: 6, title: 'Troubleshooting' }
                    ]
                }
            },
            computed: {
                editorPlaceholder() {
                    return `# Your markdown content here...

## Features
- Write in markdown
- Upload files via sidebar
- Search and link pages
- Live preview available

Start writing your content here. The editor is now centered with a fixed maximum width for better readability and focus.`
                },
                filteredSearchResults() {
                    if (!this.searchQuery.trim()) {
                        return this.searchResults
                    }
                    return this.searchResults.filter(result => 
                        result.title.toLowerCase().includes(this.searchQuery.toLowerCase())
                    )
                }
            },
            methods: {
                toggleSidebar() {
                    this.sidebarVisible = !this.sidebarVisible
                    this.saveSidebarState()
                },
                
                toggleDistractionFree() {
                    this.distractionFree = !this.distractionFree
                    this.saveDistractionFreeState()
                },
                
                saveContent() {
                    console.log('Saving:', {
                        content: this.content,
                        frontmatter: this.frontmatter
                    })
                    // Here you would implement actual save functionality
                    this.showNotification('Content saved successfully!')
                },
                
                showNotification(message) {
                    // Simple notification - in a real app you'd use a proper notification system
                    alert(message)
                },
                
                toggleSection(section) {
                    this.sections[section] = !this.sections[section]
                    this.saveSectionStates()
                },
                
                autoResize(event) {
                    const textarea = event.target
                    textarea.style.height = 'auto'
                    textarea.style.height = Math.max(500, textarea.scrollHeight) + 'px'
                },
                
                triggerFileInput() {
                    this.$refs.fileInput.click()
                },
                
                handleFileSelect(event) {
                    const files = Array.from(event.target.files)
                    files.forEach(file => this.addFile(file))
                },
                
                handleDrop(event) {
                    event.preventDefault()
                    this.isDragOver = false
                    const files = Array.from(event.dataTransfer.files)
                    files.forEach(file => this.addFile(file))
                },
                
                addFile(file) {
                    const newFile = {
                        id: Date.now() + Math.random(),
                        name: file.name,
                        type: file.type.startsWith('image/') ? 'image' : 'file',
                        menuOpen: false,
                        resizeOpen: false,
                        resizeWidth: '',
                        resizeHeight: ''
                    }
                    this.files.push(newFile)
                },
                
                toggleFileMenu(fileId) {
                    // Close all other menus
                    this.files.forEach(file => {
                        if (file.id !== fileId) {
                            file.menuOpen = false
                        }
                    })
                    
                    const file = this.files.find(f => f.id === fileId)
                    if (file) {
                        file.menuOpen = !file.menuOpen
                    }
                },
                
                renameFile(file) {
                    const newName = prompt('Enter new filename:', file.name)
                    if (newName && newName.trim()) {
                        file.name = newName.trim()
                    }
                    file.menuOpen = false
                },
                
                deleteFile(fileId) {
                    if (confirm('Are you sure you want to delete this file?')) {
                        const index = this.files.findIndex(f => f.id === fileId)
                        if (index > -1) {
                            this.files.splice(index, 1)
                        }
                    }
                },
                
                toggleImageResize(fileId) {
                    const file = this.files.find(f => f.id === fileId)
                    if (file) {
                        file.resizeOpen = !file.resizeOpen
                        file.menuOpen = false
                    }
                },
                
                applyImageResize(file) {
                    const width = file.resizeWidth
                    const height = file.resizeHeight
                    let markdown = `![${file.name}](${file.name}`
                    if (width || height) {
                        markdown += ` =${width || ''}x${height || ''}`
                    }
                    markdown += ')'
                    
                    this.insertAtCursor(markdown)
                    file.resizeOpen = false
                },
                
                insertFileLink(file) {
                    const isImage = file.type === 'image'
                    const link = isImage ? `![${file.name}](${file.name})` : `[${file.name}](${file.name})`
                    this.insertAtCursor(link)
                },
                
                insertPageLink(page) {
                    const link = `[${page.title}](${page.title.toLowerCase().replace(/\s+/g, '-')})`
                    this.insertAtCursor(link)
                },
                
                insertAtCursor(text) {
                    const textarea = this.$refs.editor
                    const start = textarea.selectionStart
                    const end = textarea.selectionEnd
                    
                    this.content = this.content.substring(0, start) + text + this.content.substring(end)
                    
                    this.$nextTick(() => {
                        textarea.focus()
                        textarea.setSelectionRange(start + text.length, start + text.length)
                    })
                },
                
                performSearch() {
                    // Search functionality is handled by computed property
                    console.log('Searching for:', this.searchQuery)
                },
                
                checkWideScreen() {
                    this.wideScreen = window.innerWidth >= 1400
                },
                
                // State persistence helpers
                saveSidebarState() {
                    if (typeof Storage !== 'undefined') {
                        localStorage.setItem('oddity-sidebar-visible', this.sidebarVisible)
                    }
                },
                
                saveDistractionFreeState() {
                    if (typeof Storage !== 'undefined') {
                        localStorage.setItem('oddity-distraction-free', this.distractionFree)
                    }
                },
                
                saveSectionStates() {
                    if (typeof Storage !== 'undefined') {
                        localStorage.setItem('oddity-sections', JSON.stringify(this.sections))
                    }
                },
                
                loadSavedStates() {
                    if (typeof Storage !== 'undefined') {
                        // Load sidebar state
                        const sidebarState = localStorage.getItem('oddity-sidebar-visible')
                        if (sidebarState !== null) {
                            this.sidebarVisible = sidebarState === 'true'
                        }
                        
                        // Load distraction-free state
                        const distractionFreeState = localStorage.getItem('oddity-distraction-free')
                        if (distractionFreeState !== null) {
                            this.distractionFree = distractionFreeState === 'true'
                        }
                        
                        // Load section states
                        const sectionsState = localStorage.getItem('oddity-sections')
                        if (sectionsState) {
                            try {
                                this.sections = { ...this.sections, ...JSON.parse(sectionsState) }
                            } catch (e) {
                                console.warn('Failed to load section states:', e)
                            }
                        }
                    }
                }
            },
            
            mounted() {
                // Load saved states
                this.loadSavedStates()
                
                // Check wide screen on mount and resize
                this.checkWideScreen()
                window.addEventListener('resize', this.checkWideScreen)
                
                // Close file menus when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.file-item') && !e.target.closest('[class*="file-menu"]')) {
                        this.files.forEach(file => {
                            file.menuOpen = false
                        })
                    }
                })
            },
            
            beforeUnmount() {
                window.removeEventListener('resize', this.checkWideScreen)
            }
        }).mount('#app')
    </script>

    <style>
        /* Custom styles for distraction-free mode */
        .distraction-free .fixed {
            display: none !important;
        }
        
        .distraction-free .fixed .compact-btn {
            display: none !important;
        }
        
        /* Ensure proper hover states for file items */
        .file-item:hover .opacity-0 {
            opacity: 1 !important;
        }
    </style>
</body>
</html>